vendor them vendor_member

phan quyen bnag authority

Chức năng,OWNER,ADMIN,STAFF,PRODUCT_EDITOR,WAREHOUSE_PICKER,VIEWER
"Vendor info & profile (xem/sửa thông tin shop, logo, address, tax...)",Full (CRUD),Full (CRUD),View only,View only,View only,View only
Mời/thêm/xóa thành viên shop,Yes,Yes,No,No,No,No
Product CRUD,,,,,,
- Xem danh sách sản phẩm,Yes,Yes,Yes,Yes,Yes (nếu cần),Yes
- Thêm sản phẩm mới,Yes,Yes,Yes,Yes,No,No
- Sửa sản phẩm/variant/giá,Yes,Yes,Yes,Yes,No,No
- Xóa/ngừng bán sản phẩm,Yes,Yes,No,Yes (tùy config),No,No
- Import/Export sản phẩm,Yes,Yes,Yes,Yes,No,No
Inventory & Warehouse,,,,,,
- Xem tồn kho tổng thể,Yes,Yes,Yes,Yes,Yes,Yes
- Xem chi tiết tồn theo vị trí,Yes,Yes,Yes,No,Yes,Yes
- Nhập kho (Inbound order),Yes,Yes,Yes,No,Yes,No
- Xác nhận nhận hàng,Yes,Yes,Yes,No,Yes,No
- Xuất kho / Fulfillment order,Yes,Yes,Yes,No,Yes,View only
- Pick & Pack hàng,Yes,Yes,Yes,No,Yes,No
- Điều chỉnh tồn kho thủ công,Yes,Yes,No,No,Có thể (tùy),No
- Xem lịch sử stock movement,Yes,Yes,Yes,Yes,Yes,Yes
Đơn hàng & Fulfillment,,,,,,
- Xem danh sách đơn,Yes,Yes,Yes,No,Yes (đơn cần xuất),Yes
"- Xử lý đơn (confirm, cancel...)",Yes,Yes,Yes,No,No,No
- In vận đơn / packing list,Yes,Yes,Yes,No,Yes,No

db cua auth-service
-- Bảng người dùng (chỉ từ social login)
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    provider VARCHAR(50) NOT NULL,                  -- 'google', 'facebook', 'apple', 'microsoft', etc.
    provider_id VARCHAR(255) NOT NULL,              -- ID từ provider
    email VARCHAR(255) NOT NULL,
    full_name VARCHAR(255),
    avatar_url VARCHAR(500),
    email_verified BOOLEAN DEFAULT TRUE,
    last_login TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    UNIQUE(provider, provider_id),
    UNIQUE(email)                                   -- Optional: tránh 1 email đăng ký nhiều provider
);

CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_provider ON users(provider, provider_id);

-- Bảng roles toàn hệ thống
CREATE TABLE roles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) UNIQUE NOT NULL,              -- PLATFORM_ADMIN, VENDOR_OWNER, VENDOR_ADMIN, VENDOR_STAFF, VENDOR_WAREHOUSE_PICKER, VENDOR_VIEWER
    description TEXT
);

-- Gán role cho user
CREATE TABLE user_roles (
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    role_id UUID REFERENCES roles(id) ON DELETE CASCADE,
    PRIMARY KEY (user_id, role_id)
);

-- Đăng ký các client OAuth2 (frontend + backend services)
CREATE TABLE oauth2_registered_clients (
    id VARCHAR(255) PRIMARY KEY,                    -- client_id
    client_id_issued_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    client_secret VARCHAR(255),                     -- NULL nếu public client (frontend)
    client_secret_expires_at TIMESTAMP,
    client_name VARCHAR(255) NOT NULL,
    client_authentication_methods TEXT NOT NULL,    -- 'client_secret_basic','none'
    authorization_grant_types TEXT NOT NULL,        -- 'authorization_code','refresh_token','client_credentials'
    redirect_uris TEXT,                             -- Chỉ cho frontend
    post_logout_redirect_uris TEXT,
    scopes TEXT NOT NULL,                           -- 'openid','profile','wms.read','inventory.manage',...
    client_settings JSONB DEFAULT '{}',             -- requireProofKey, etc.
    token_settings JSONB DEFAULT '{}'               -- accessTokenFormat: JWT, reuseRefreshTokens...
);

-- Lưu authorization (code, token, consent) – theo chuẩn Spring Authorization Server
CREATE TABLE oauth2_authorizations (
    id VARCHAR(255) PRIMARY KEY,
    registered_client_id VARCHAR(255) REFERENCES oauth2_registered_clients(id),
    principal_name VARCHAR(255),                     -- user email hoặc sub
    authorization_grant_type VARCHAR(100) NOT NULL,
    attributes TEXT,
    state VARCHAR(500),
    authorization_code_value BYTEA,
    authorization_code_issued_at TIMESTAMP,
    authorization_code_expires_at TIMESTAMP,
    access_token_value BYTEA,
    access_token_issued_at TIMESTAMP,
    access_token_expires_at TIMESTAMP,
    access_token_scopes TEXT[],
    refresh_token_value BYTEA,
    refresh_token_issued_at TIMESTAMP,
    refresh_token_expires_at TIMESTAMP
);

CREATE TABLE oauth2_authorization_consents (
    registered_client_id VARCHAR(255) REFERENCES oauth2_registered_clients(id),
    principal_name VARCHAR(255),
    authorities TEXT NOT NULL,                       -- scopes đã consent
    PRIMARY KEY (registered_client_id, principal_name)
);